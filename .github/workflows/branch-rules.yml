name: Enforce Branch Merge Rules
on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

jobs:
  enforce-branch-rules:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR rules
        run: |
          BASE=${{ github.event.pull_request.base.ref }}
          HEAD=${{ github.event.pull_request.head.ref }}

          echo "PR from $HEAD to $BASE"

          # Rule 1: feature/* can only go to dev
          if [[ "$HEAD" == feature/* && "$BASE" != "dev" ]]; then
            echo "❌ Feature branches can only be merged into dev"
            exit 1
          fi

          # Rule 2: No direct merge to main except from dev
          if [[ "$BASE" == "main" && "$HEAD" != "dev" ]]; then
            echo "❌ Only dev can merge into main"
            exit 1
          fi
